<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://undnull.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://undnull.github.io/" rel="alternate" type="text/html" hreflang="en" /><updated>2021-07-10T18:13:57+00:00</updated><id>https://undnull.github.io/feed.xml</id><title type="html">GPRB</title><subtitle>From Russia with love!</subtitle><entry><title type="html">The V16 virtual CPU</title><link href="https://undnull.github.io/2021/07/10/V16.html" rel="alternate" type="text/html" title="The V16 virtual CPU" /><published>2021-07-10T23:10:00+00:00</published><updated>2021-07-10T23:10:00+00:00</updated><id>https://undnull.github.io/2021/07/10/V16</id><content type="html" xml:base="https://undnull.github.io/2021/07/10/V16.html">&lt;p&gt;I always have been amazed how fast 0x10c game skyrocketed, created a whole community of DCPU-16 programmers and then suddenly died leaving lots of content just like… abandoned. 
The DCPU-16 architecture inspired me to write an emulator for it which eventually became its own virtual CPU architecture called V16 (Virtual 16-bit VM, duh).&lt;/p&gt;

&lt;h2 id=&quot;version-history&quot;&gt;Version history&lt;/h2&gt;
&lt;h3 id=&quot;dcpu-emulator&quot;&gt;DCPU emulator&lt;/h3&gt;
&lt;p&gt;When I firstly read about cancelled 0x10c game and DCPU-16, I really started looking forward to write a nice emulator for it so that I can write programs and possibly write an operating system for it. However, while the idea was growing and changing, other projects such as Refraction and Thorn started to take shape and I eventually forgot about that.&lt;/p&gt;

&lt;h3 id=&quot;v16v1&quot;&gt;V16v1&lt;/h3&gt;
&lt;p&gt;The first non-DCPU version had a lot of just wrong stuff that was making the instruction format hard to understand and bad in general: it still had pointer access within operands. This was obviously a bad idea because instructions could grow up to &lt;strong&gt;six&lt;/strong&gt; words in size!&lt;br /&gt;
After a Habr post I decided to purge everything and put the project on hold for a while.
&lt;img src=&quot;/assets/images/V16v1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;v16v2-v16risc&quot;&gt;V16v2: V16RISC&lt;/h3&gt;
&lt;p&gt;After some time I decided to get back to implementing a virtual machine but this time with a better architecture and instruction set: and I choose to make a RISC-like machine with 16-bit words as minimal addressable units with 1 to 3 word instruction length.&lt;br /&gt;
However after some time I was left unsatisfied with the results of my work: the VM core was fine but the assembler written in JavaScript was a pain in the ass for me since I wanted this thing to be buildable and runnable without any dependencies on a UNIX-like system.&lt;br /&gt;
So after some hesitation I decided to archive the &lt;a href=&quot;https://github.com/undnull/V16RISC&quot;&gt;repo&lt;/a&gt; and again start working on a better architecture.&lt;/p&gt;

&lt;h3 id=&quot;v16v3&quot;&gt;V16v3&lt;/h3&gt;
&lt;p&gt;The final version is more like the first one. However a lot of stuff that was similar to DCPU-16 is now missing. This includes:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Pointer math in operands. Now V16RISC’s memory read/write instructions are used.&lt;/li&gt;
  &lt;li&gt;Complicated system of constants. The only flag operands have is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMM&lt;/code&gt; flag which tells the runtime that a constant value should be used instead of a register reference.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/V16v3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The project’s &lt;a href=&quot;https://github.com/undnull/V16&quot;&gt;repo&lt;/a&gt; contains four different projects:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The V16 library: the runtime’s core. Has no input or output functionality.&lt;/li&gt;
  &lt;li&gt;V16ASM: a simple 500 LoC assembler written in C.&lt;/li&gt;
  &lt;li&gt;V16DASM: a simple disassembler.&lt;/li&gt;
  &lt;li&gt;V16EXEC: a terminal-based runtime implementation.&lt;/li&gt;
  &lt;li&gt;V16SYS: a graphical runtime with other virtual hardware that should represent an authentic DCPU computer.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;a-bit-of-docs&quot;&gt;A bit of docs&lt;/h2&gt;
&lt;h3 id=&quot;instruction-format&quot;&gt;Instruction format&lt;/h3&gt;
&lt;p&gt;If the VM needs an another value, it reads the value at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memory[PC++]&lt;/code&gt;.&lt;br /&gt;
Every instruction is at least one word wide. This word has the following structure:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Bits&lt;/th&gt;
      &lt;th&gt;Value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;15-10&lt;/td&gt;
      &lt;td&gt;The opcode&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;&quot;A&quot; operand &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMM&lt;/code&gt; flag&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8-5&lt;/td&gt;
      &lt;td&gt;&quot;A&quot; operand register number&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;&quot;B&quot; operand &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMM&lt;/code&gt; flag&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3-0&lt;/td&gt;
      &lt;td&gt;&quot;B&quot; operand register number&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IMM&lt;/code&gt; flag means that a register number should be ignored and a constant value must be used. A constant value cannot be written to so instructions that write to a specific operand won’t do anything because the runtime will silently ignore them.&lt;/p&gt;

&lt;h3 id=&quot;registers&quot;&gt;Registers&lt;/h3&gt;
&lt;p&gt;There are 16 registers that can be accessed from any instruction. This means you can set any value to the program counter without any additional instructions like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JMP&lt;/code&gt;.&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Register index&lt;/td&gt;
      &lt;td&gt;Common name&lt;/td&gt;
      &lt;td&gt;Description&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R0&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x01&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R1&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x02&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R2&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x03&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R3&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x04&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R4&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x05&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R5&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x06&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R6&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x07&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R7&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x08&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R8&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x09&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;R9&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;General-purpose register&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0A&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RI&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Counter (acts as a GPR)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0B&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RJ&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Counter (acts as a GPR)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0C&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Interrupt routine address&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0D&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OF&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Overflow&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0E&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SP&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Stack pointer&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0F&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PC&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Program counter&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;communicating-between-devices&quot;&gt;Communicating between devices&lt;/h3&gt;
&lt;p&gt;Again, built-in device support is in common with DCPU-16. But unlike DCPU-16 V16 uses x86-like IO ports to do this.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt;IOR $0x00FF, %R0    # Read port 0x00FF to R0
IOW %R0, $0x000F    # Write R0 to port 0x000F
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This approach, however, can be a bit slow if a device decides to do some time-consuming actions so be aware that sending and receiving data is a possible CPU time eliminator.&lt;/p&gt;

&lt;p&gt;The runtime library provides two callback functions for implementations to provide their own logic to communicate between devices and the CPU:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// value is guaranteed to be non-NULL.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;IMPL_ioread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V16_vm_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// We have a hit!&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00FF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// If no value was written (eg. no device owns the specified port)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;IMPL_iowrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;V16_vm_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Writing at 0x00FF will result in putchar()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00FF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;putchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;memory-access&quot;&gt;Memory access&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;But how can I write stuff to the memory if I have no pointer math in instructions?!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Well to counter that, two RISC-ish instructions are introduced:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt;MRD $0x8000, %R0    # Read memory[0x8000] to R0
MWR %R0, $0x8A00    # Write R0 to memory[0x8A00]
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;instruction-set&quot;&gt;Instruction set&lt;/h3&gt;
&lt;p&gt;There are up to 64 possible instructions.&lt;br /&gt;
The following table shows all the defined instructions. All the logical operations (in descriptions) are in C syntax. All the opcodes that are &lt;em&gt;not&lt;/em&gt; shown here are reserved and treated as invalid (the execution stops).&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Opcode&lt;/th&gt;
      &lt;th&gt;Mnemonic&lt;/th&gt;
      &lt;th&gt;A mode&lt;/th&gt;
      &lt;th&gt;B mode&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NOP&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Do nothing&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x01&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HLT&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Halt and wait for interrupts&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x02&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PTS&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Push to stack&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x03&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PFS&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;WRITE&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Pull from stack&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x04&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAL&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Call a subroutine&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x05&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RET&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Return from a subroutine&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x06&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOR&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;WRITE&lt;/td&gt;
      &lt;td&gt;Read from an IO port&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x07&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOW&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Write to an IO port&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x08&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MRD&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;WRITE&lt;/td&gt;
      &lt;td&gt;Read memory&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x09&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MWR&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Write memory&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0A&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CLI&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Disable interrupts&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0B&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STI&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Enable interrupts&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0C&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INT&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Trigger an interrupt&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x0D&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RFI&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Return from interrupt routine&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x20&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IEQ&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B == A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x21&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INE&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B != A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x22&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IGT&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B &amp;gt;  A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x23&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IGE&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B &amp;gt;= A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x24&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ILT&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B &amp;lt;  A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x25&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ILE&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;Skip next if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!(B &amp;lt;= A)&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MOV&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ADD&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B + A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SUB&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B - A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MUL&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B * A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DIV&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B / A&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = 0&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MOD&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B % A&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SHL&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B &amp;lt;&amp;lt; A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SHR&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B &amp;gt;&amp;gt; A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AND&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B &amp;amp; A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BOR&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B | A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XOR&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READ&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B ^ A&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NOT&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = ~B&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INC&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B + 1&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x30&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DEC&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;READWRITE&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B = B - 1&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;interrupts&quot;&gt;Interrupts&lt;/h3&gt;
&lt;p&gt;When the attention is needed to a device, an interrupt is triggered. There’s an interrupt queue of 256 interrupts. If the queue grows over 256, the execution stops.&lt;br /&gt;
Interrupt routine is a subroutine which returns using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RFI&lt;/code&gt; instruction. When this routine is called, the value of R0 register is pushed to the stack and replaced with an argument. The routine address is stored in the IA register.&lt;/p&gt;

&lt;h3 id=&quot;assembly-syntax&quot;&gt;Assembly syntax&lt;/h3&gt;
&lt;p&gt;Since the assembler is written in just two days, it lacks a lot of stuff like directives. However it is already possible to write some cool code with it. The basic syntax is:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[label:] &amp;lt;mnemonic&amp;gt; [&amp;lt;prefix&amp;gt;argument[, &amp;lt;prefix&amp;gt;argument]] [# comment]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;label&lt;/td&gt;
      &lt;td&gt;A current PC position right before an instruction starts.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mnemonic&lt;/td&gt;
      &lt;td&gt;An opcode translated into human-readable form.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;prefix&lt;/td&gt;
      &lt;td&gt;An operand prefix. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$&lt;/code&gt; for constants, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%&lt;/code&gt; for registers.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;argument&lt;/td&gt;
      &lt;td&gt;An identifier (label’s name, register’s name) or a number.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;comment&lt;/td&gt;
      &lt;td&gt;Ignored.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Example code (&lt;a href=&quot;https://github.com/undnull/V16/blob/master/prog/ASCIItest.S&quot;&gt;link&lt;/a&gt;):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt;# ASCIItest.S - prints the ASCII table
# in seven colors, than freezes.
mov $0x8000, %r0
mov $0x0800, %r1
loop:
    ige $0x0FFF, %r1
    mov $end, %pc
    mwr %r1, %r0
    inc %r0
    inc %r1
    mov $loop, %pc
end:
    mov $end, %pc
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;hardware-devices&quot;&gt;Hardware devices&lt;/h2&gt;
&lt;h3 id=&quot;lpm-25&quot;&gt;LPM-25&lt;/h3&gt;
&lt;p&gt;LPM25 is a 320x200 pixel color display compatible with V16 hardware. The display is split into 4x8 pixel cells which displays a colored character making a 80x25 grid of characters.&lt;br /&gt;
LPM25 has no internal video memory: instead it uses the internal V16 memory in read-only mode.&lt;br /&gt;
The display reads from the memory at constant rate of 50 times per second (50 Hz).&lt;br /&gt;
LPM25 reads text data from memory at TEXT_OFF address. Each text cell consists of three parts:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Bits&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0-3&lt;/td&gt;
      &lt;td&gt;Background color.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4-7&lt;/td&gt;
      &lt;td&gt;Foreground color.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8-15&lt;/td&gt;
      &lt;td&gt;8-bit ASCII code.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The glyps for characters are also read from memory at CHAR_OFF address. Each glyph is a 32-bit big-endian value divided by eight quartets representing a row in the glyph (The default ‘A’ character is equal to 0x04AAEAAA).&lt;/p&gt;

&lt;p&gt;LPM-25 provides a hardware cursor that looks like a character with inverted colors.&lt;br /&gt;
The cursor offset can be set via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CUR_OFF&lt;/code&gt; register. Cursor can blink with interval set via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CUR_BLINK&lt;/code&gt; register. If the blink interval is set to zero, cursor is always visible.&lt;/p&gt;

&lt;p&gt;LPM-25 uses a bunch of IO ports to communicate with the CPU:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Port number&lt;/th&gt;
      &lt;th&gt;Port name&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1F01&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TEXT_OFF&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Text data pointer.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1F02&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CHAR_OFF&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Charset pointer.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1F03&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CUR_POS&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Cursor position.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1F04&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CUR_BLINK&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Cursor blink interval (in milliseconds).&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/LPM25.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;generic-keyboard&quot;&gt;Generic keyboard&lt;/h3&gt;
&lt;p&gt;When a key is pressed, the device triggers an interrupt with argument value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x000F&lt;/code&gt;.&lt;br /&gt;
Within the interrupt handler, a value can be read from port &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x000F&lt;/code&gt;. This value can be:&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Value&lt;/td&gt;
      &lt;td&gt;Description&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF01&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Backspace&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF02&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Return (Enter)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF03&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Insert&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF04&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Delete&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF05&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Up arrow&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF06&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Down arrow&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF07&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Left arrow&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF08&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Right arrow&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF09&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Shift&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xFF0A&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;Ctrl&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00**&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;8-bit ASCII code&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;
&lt;p&gt;At that point I have no plans of actively continuing the development but I consider writing this VM and utilities a big experience in C programming ;)&lt;/p&gt;</content><author><name></name></author><category term="V16" /><category term="C" /><summary type="html">I always have been amazed how fast 0x10c game skyrocketed, created a whole community of DCPU-16 programmers and then suddenly died leaving lots of content just like… abandoned. The DCPU-16 architecture inspired me to write an emulator for it which eventually became its own virtual CPU architecture called V16 (Virtual 16-bit VM, duh).</summary></entry><entry><title type="html">First post!</title><link href="https://undnull.github.io/2021/07/09/first-post.html" rel="alternate" type="text/html" title="First post!" /><published>2021-07-09T23:00:00+00:00</published><updated>2021-07-09T23:00:00+00:00</updated><id>https://undnull.github.io/2021/07/09/first-post</id><content type="html" xml:base="https://undnull.github.io/2021/07/09/first-post.html">&lt;h1 id=&quot;a-blog&quot;&gt;A blog&lt;/h1&gt;
&lt;p&gt;So I decided to replace the old site contents with a new fancy Jekyll-based blog.&lt;br /&gt;
I will be working on moving the JTERM code into a new repo which will be accessible from GitHub.&lt;br /&gt;
&lt;img src=&quot;/assets/images/old_gprbme.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;international-troubles&quot;&gt;International troubles&lt;/h1&gt;
&lt;p&gt;You see, a simple terminal-based site is a good choice just because you don’t actually have to &lt;em&gt;translate&lt;/em&gt; it. So when I decided to replace JTERM with this blog, I started to think about ways to write posts in both English and Russian. The problem with that is I would have two times more work than with a single language because I &lt;em&gt;cannot translate stuff on-fly&lt;/em&gt;. After some time I decided that I’d actually write my posts in English here.&lt;/p&gt;</content><author><name></name></author><category term="jekyll" /><summary type="html">A blog So I decided to replace the old site contents with a new fancy Jekyll-based blog. I will be working on moving the JTERM code into a new repo which will be accessible from GitHub.</summary></entry></feed>